<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/locuszoom@0.10.0-beta.1/dist/locuszoom.css"
        type="text/css"/>
  <title>PheGET - Single Variant View</title>
</head>
<body>

  <h1>eQTL for one variant in all tissues</h1>
  <div>
   <input id="query-field" type="text" width="100" placeholder="chr19:6718376">
   <button id='navigate-variant' class="btn btn-success">Go</button> <br>
   <a href="/">Back to PheGET Homepage</a>
  </div>

  <button  id="tissue">Group by Tissue</button>
  <button  id="system">Group by System</button>
  <button  id="symbol">Group by Gene Symbol</button>
  <div id="plot"></div>

  {# These files must be included to make a LocusZoom plot #}
  <script src="https://cdn.jsdelivr.net/npm/locuszoom@0.10.0-beta.1/dist/locuszoom.vendor.min.js"
          type="application/javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/locuszoom@0.10.0-beta.1/dist/locuszoom.app.min.js"
          type="application/javascript"></script>

  {#  FIXME: Remove dependence on jquery in favor of native functions #}
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" type="application/javascript"></script>
  <script src="{{ url_for('static', filename='js/phewas_scatter.js') }}" type="application/javascript"></script>
  <script type="application/javascript">
    const [plot, datasources] = makePhewasPlot({{chrom|tojson}}, {{pos|tojson}}, '#plot');
  </script>
<script>
  // This is an absolutely simplistic MVP. It contains no validation and doesn't even attempt to help the user if they
  //  ask for a gibberish variant

  // This code uses some es6 syntax and may not work in older browsers. But it's 7pm so Alan can fix that himself.
  document.getElementById('navigate-variant').addEventListener('click', function() {
      const variant = document.getElementById('query-field');

      if (!variant) {
          return;
      }
      const [chrom, pos] = variant.value.split(':');  // UI - user types `chrom:pos`

      // Eventually the search box will be smarter than this. Hackety hack!
      window.location = `/variant/${chrom}_${pos}`;
  });
</script>
</body>
</html>
