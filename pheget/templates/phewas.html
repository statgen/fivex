<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/locuszoom@0.10.0-beta.1/dist/locuszoom.css"
          type="text/css"/>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/tabulator-tables@4.4.3/dist/css/bootstrap/tabulator_bootstrap4.min.css">
    <title>PheGET - Single Variant View</title>
</head>

<style>
    .padtop {
        padding-top: 20px;
    }
</style>

<body>


<div class="padtop">
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-10">
                <div id="home-searchbox">
                    <form id="variant-search">
                        <div class="input-group">
                            <input id="query-field" name="query-field" autocomplete="off" class="form-control"
                                   type="text"
                                   placeholder="Search for a variant, e.g. chr19:488506 or rs10424907" autofocus/>

                            <div class="input-group-append">
                                <button id="navigate-variant" class="btn btn-primary" type="submit">Search</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<center>
    <a href="/">Back to PheGET Homepage</a>
</center>
<h1>chr{{ chrom }}:{{ "{:,}".format(pos) }} for all tissues and genes</h1>
</div>

<div class="container-fluid">
    <div class="btn-group btn-group-toggle" data-toggle="buttons">
        <div class="btn-group btn-group-toggle" data-toggle="buttons">
            <label class="btn btn-primary">
                <input type="radio" name="group-options" autocomplete=off id="group-tissue"
                       onclick="groupByThing(plot, 'tissue');"/> Tissue
            </label>
            <label class="btn btn-primary">
                <input type="radio" name="group-options" autocomplete=off id="group-system"
                       onclick="groupByThing(plot, 'system');" checked/> System
            </label>
            <label class="btn btn-primary">
                <input type="radio" name="group-options" autocomplete=off id="group-symbol"
                       onclick="groupByThing(plot, 'symbol');"/> Gene
            </label>
        </div>

        <div class="btn-group btn-group-toggle" data-toggle="buttons">
            <label class="btn btn-success">
                <input type="radio" name="y-options" autocomplete=off id="show-log-pvalue"
                       onclick="switchY(plot, table, 'log_pvalue');"/> P-values
            </label>
            <label class="btn btn-success">
                <input type="radio" name="y-options" autocomplete=off id="show-beta" onclick="switchY(plot, table, 'beta');"/>
                Betas
            </label>
        </div>

        <button id="label-toggle" type="button" class="btn btn-info">Toggle labels</button>
        <br>

    </div>
</div>

<div id="plot"></div>

<div>
    Query a single tissue for a single gene: <br>
    <form action="/singlegene" method="get">
        <input name="chrom" type="hidden" value="{{chrom}}">
        <input name="pos" type="hidden" value="{{pos}}">
        <input name="gene_id" type="text" placeholder="ENSG00000169684.13" value="ENSG00000169684.13">
        <input name="tissue" type="text" placeholder="Brain_Cortex" value="Brain_Cortex">
        <button type="submit">Search</button>
     </form>
</div>

<div id="table" style="width:90%;margin:0 auto"></div>

{# These files must be included to make a LocusZoom plot #}
<script src="https://cdn.jsdelivr.net/npm/locuszoom@0.10.0-beta.1/dist/locuszoom.vendor.min.js"
        type="application/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/locuszoom@0.10.0-beta.1/dist/locuszoom.app.min.js"
        type="application/javascript"></script>

<script src="https://cdn.jsdelivr.net/npm/tabulator-tables@4.4.3/dist/js/tabulator.min.js"
        type="text/javascript"></script>

<script src="{{ url_for('static', filename='js/phewas_scatter.js') }}" type="application/javascript"></script>
<script src="{{ url_for('static', filename='js/searchbox.js') }}" type="application/javascript"></script>
<script type="application/javascript">
    const table = makeTable('#table');
    const [plot, datasources] = makePhewasPlot({{chrom|tojson}}, {{pos|tojson}}, '#plot');
    plot.subscribeToData(['phewas:log_pvalue', 'phewas:gene_id', 'phewas:tissue', 'phewas:system', 'phewas:symbol', 'phewas:beta', 'phewas:stderr_beta'], updateTable.bind(null, table));

    // Use omnisearch (https://portaldev.sph.umich.edu/api_internal_dev/v1/annotation/omnisearch) to parse rsids
    document.getElementById('variant-search').addEventListener('submit', function () {
        event.preventDefault();
        const variant = document.getElementById('query-field').value;
        if (!variant) {
            return;
        }
        parseSearch(variant);
    });
    document.getElementById('label-toggle').addEventListener('click', function() {
        labelToggle(plot);
    });
</script>
</body>
</html>
